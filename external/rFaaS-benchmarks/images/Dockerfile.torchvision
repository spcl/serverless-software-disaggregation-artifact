FROM ubuntu:21.04

RUN apt-get update && apt-get install --no-install-recommends -y gcc g++ make cmake unzip wget libpng-dev libjpeg-dev libpython3-dev
RUN wget --no-check-certificate -q https://download.pytorch.org/libtorch/cpu/libtorch-cxx11-abi-shared-with-deps-1.11.0%2Bcpu.zip
RUN unzip -q libtorch-cxx11-abi-shared-with-deps-1.11.0+cpu.zip
RUN mv libtorch /opt/

RUN wget --no-check-certificate -q https://github.com/pytorch/vision/archive/refs/tags/v0.10.0.zip
RUN unzip -q v0.10.0.zip
RUN mkdir build && cd build && cmake -DCMAKE_INSTALL_PREFIX=/opt/torchvision/ -DCMAKE_PREFIX_PATH=/opt/libtorch/share/cmake ../vision-0.10.0
RUN cd build && make -j8 && make install

