
FROM spcleth/hpc-disagg:rfaas-dependencies-opencv as builder


COPY thumbnailer/ ${HOME}/thumbnailer/
RUN mkdir build_img && cd build_img && cmake -DCMAKE_PREFIX_PATH="/opt/opencv/lib64/cmake/opencv4" -DCMAKE_BUILD_TYPE=Release ../thumbnailer && make

FROM ubuntu:22.04

COPY --from=builder /opt/ /opt/
ENV LD_LIBRARY_PATH=/function
ENV LIBRARY_PATH=/function/libthumbnailer.so

RUN mkdir ${HOME}/function
COPY --from=builder ${HOME}/build_img/test-client ${HOME}/function/
COPY --from=builder ${HOME}/build_img/libthumbnailer.so ${HOME}/function/
COPY thumbnailer/0_action-adrenaline-adventure-1047051.jpg ${HOME}/function/
COPY thumbnailer/0_action-adrenaline-adventure-1047051_smaller.jpg ${HOME}/function/

